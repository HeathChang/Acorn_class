package com.service;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.List;

import org.springframework.jdbc.core.RowMapper;
import org.springframework.transaction.annotation.Transactional;

import com.dao.ProductDAO;
import com.entity.ProductDTO;

public class ProductService {
	ProductDAO dao; //set통해서 주입 
	
	@Transactional // tx 처리함 . 필요함수 위에 붙여줌: 자동 commit & rollback 실행 
	public void addOrder(String pcode,int quantity) throws Exception{
		//addOrder:주문 발생: 제품코드, 수량 
		dao.addOrder(pcode,quantity); //제품에 관련 주문 테이블 insert, 제품에 관련된 제품 테이블에서 수량 update
	}
	public ProductDAO getDao() {
		return dao;
	}
	public void setDao(ProductDAO dao) {
		this.dao = dao;
	}
	
	// 전체 상품 목록
		public List<ProductDTO> selectProduct() {
			String query = "select * from t_product order by pcode";
			return jdbcTemplate.query(query, new RowMapper<ProductDTO>() {
				@Override
				public ProductDTO mapRow(ResultSet rs, int rowNum) throws SQLException {
					ProductDTO dto = new ProductDTO();
					dto.setPcode(rs.getString("pcode"));
					dto.setPname(rs.getString("pname"));
					dto.setPrice(rs.getInt("price"));
					dto.setQuantity(rs.getInt("quantity"));
					return dto;
				}
			});
		}// end select

	
}
